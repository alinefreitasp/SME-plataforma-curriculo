kind: pipeline
name: default

clone:
  depth: 50

steps:
- name: submodules
  image: docker:git
  commands:
    - git submodule update --recursive --remote

- name: build
  image: tmaier/docker-compose:latest
  volumes:
    name: dockersock
    path: /var/run/docker.sock
  commands:
    - docker info
    - docker-compose --version
    - docker-compose -f docker-compose.yml -f docker-compose-staging.yml build
  when:
    branch:
    - devops

volumes:
  name: dockersock
  host:
    path: /var/run/docker.sock

